From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: hogliux <fabian.renn@gmail.com>
Date: Tue, 3 Sep 2024 13:07:59 +0200
Subject: UBUNTU: SAUCE: Add Bluetooth support for the Lenovo Yoga Slim 7x

BugLink: https://bugs.launchpad.net/bugs/2100858

Signed-off-by: Tobias Heider <tobias.heider@canonical.com>
Signed-off-by: Paolo Pisati <paolo.pisati@canonical.com>
---
 .../dts/qcom/x1e80100-lenovo-yoga-slim7x.dts  | 21 +++++++++++++++++++
 1 file changed, 21 insertions(+)

diff --git a/arch/arm64/boot/dts/qcom/x1e80100-lenovo-yoga-slim7x.dts b/arch/arm64/boot/dts/qcom/x1e80100-lenovo-yoga-slim7x.dts
index 6176e7e7299b..ede7b189a77b 100644
--- a/arch/arm64/boot/dts/qcom/x1e80100-lenovo-yoga-slim7x.dts
+++ b/arch/arm64/boot/dts/qcom/x1e80100-lenovo-yoga-slim7x.dts
@@ -19,6 +19,7 @@ / {
 
 	aliases {
 		serial0 = &uart21;
+		serial1 = &uart14;
 	};
 
 	chosen {
@@ -1353,6 +1354,14 @@ &tlmm {
 			       <44 4>, /* SPI (TPM) */
 			       <238 1>; /* UFS Reset */
 
+        bt_en_default: bt-en-sleep {
+		pins = "gpio116";
+		function = "gpio";
+		output-low;
+		bias-disable;
+		qcom,drive-strength = <16>;
+	};
+
 	cam_rgb_default: cam-rgb-default-state {
 		mclk-pins {
 			pins = "gpio100";
@@ -1535,6 +1544,18 @@ usb2_pwr_3p3_reg_en: usb2-pwr-3p3-reg-en-state {
 	};
 };
 
+&uart14 {
+	status = "okay";
+
+	bluetooth: bt_wcn7850 {
+		compatible = "qcom,wcn7850-bt";
+		pinctrl-names = "default";
+		pinctrl-0 = <&bt_en_default>;
+		enable-gpios = <&tlmm 116 GPIO_ACTIVE_HIGH>;
+		max-speed = <3200000>;
+	};
+};
+
 &uart21 {
 	compatible = "qcom,geni-debug-uart";
 	status = "okay";
-- 
2.51.0

